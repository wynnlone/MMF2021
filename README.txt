# MMF2021
# RM Lab

# System documentation #######################################################################################
(ref: - please refer to the following folder or files for detail discription in the Folder directory section)

# 0. Time point and time period break down ====================================

## 5-year backwards: calibration period (ref: input_data)
## 2006/4/1: earlest date for calibration period
## 2011/4/1-2016/4/1: back testing period test for different strategies (ref: performance_data)
## 2016/4/1-2021/6/1: portfolio running period (ref: report_data)
## 2021/6/1: report date (ref: Analysis)
## 2021/6/1-: (ref: Scenario_data)

# 1. Portfolio construction methodology and results ==========================================

## Portfolio strategy:
## Our rationale is that risk can be accepted as long as it's being reasonalbly compensated by return. Thus, we tested different commonly used strategies based on return and risk. Our goal is to maximized risk adjusted return. The metric used is Sharpe ratio. (ref: performance_data, code\optimize.ipynb)

## Instrument universe and data:
## To meet the multi-assets, dual currency requirement, the instrument universe comprise a large range of ETFs in different assets class and in both CAD and USD. (ref: input_data) 

## Mathematical models, data analysis:

### Main mathematical models used are:
### The Mean-Variance Framework based on retrun and variance for assets allocation. (ref: code\optimize.ipynb, code\main.ipynb)
### The Vector Autoreressison (VAR) model for scenario testing. (ref: Scenario_data, Analysis)

### Data analysis:
### Exposure, Return, and risk analysis are mainly implemented in excel (ref: Analysis)

## Back-testing description and results
## All strategies are backtested and data are stored (ref: performance_data). All weather is selected based on Sharpe ratio (ref: Analysis\analysis_sharpe11-16.xlsx)
## AW run1 is the first run based on original version of AW. AW run2 is after we change IYR to be no more than 15% of the USD account.

# 2. Risk model =======================================================

## Risk Model definition, calibration and market data, validation (back-testing) of risk model
### Risk metric used are STD, VaR(historic method), VaR(parametirc method assuing normal), Marginal VaR. (ref: Analysis\VaR_analysis_run2.xlsx)
### Market data and resulted data are generated by python code (ref: code\main.ipynb) and stgored in data folders (ref: performance_data, report_data)

## Scenarios – detailed description and construction
## Two types of scenario is created: historical and hypothetical (ref: code\RiskLab_Scenarios, Analysis\Hypothetical_Scenarios_Analysis)

# 3. Portfolio analytics (light-cone analytics) methodologies ================================================

## Exposures metrics 
## exposure in each asset, asset class, by absolute value, percentage of portfolio (ref: report_data, Analysis)

## Performance and attribution metrics 
## annual return, cumulative return since inception, sharpe ratio, return by asset, asset class (ref: Analysis)

## Risk and scenario metrics (ref: Analysis, code)

### Risk metrics (ref: Analysis\VaR_analysis_run2.xlsx)
### Scenario metrics (ref: Scenario_Data, code\RiskLab_Scenarios, Analysis\Hypothetical_Scenarios_Analysis)

# 4. Model Risk assessment ========================================================
# Allocation model assumes market stationarity, e.g. correlation between asset does not change signicicantly, otherwiese, the model breaks when the market behave very differently during the calibration period and on-ward period. A suggested solution will be to incorporate professional judgement or finding variables that have predictability power. (ref: code\optimize.ipynb, code\main.ipynb)
# Risk model assumes the same, we do notice that's not the case as risk metric changes as time or rolling window changes. Same suggested solution. (ref: Analysis\VaR_analysis_run2.xlsx)


# Folder Directory #################################################################################################

# Logic map: input_data => performance_data => report_data, Scenario_data => Analysis

# Folder: input_data ========================================
# All the data collected externally

## Market price data:

## Barclay Fund of Funds Index, used as Benchmark
## Since they are so varied, funds of funds can be hard to track as a group and to compare. However, an index does exist. The Barclay Fund of Funds Index, sponsored by Barclay-Hedge, a provider of data on alternative investments, is a measure of the average return of all FOFs that report into the company database; it includes some 500 to 650 funds.

### from yahoofinance:

#### USD 

#### 1. Equity & Credit

#### SPY: SPDR S&P 500 Trust ETF
#### is one of the most popular funds that aims to track the Standard & Poor's 500 Index.
#### this eft represents the large- and mid-cap U.S. stocks.

#### QQQ: Invesco QQQ Trust ETF
#### is an exchange-traded fund that tracks the Nasdaq-100 Index.
#### this eft represents the 100 largest non-financial companies listed on the Nasdaq based on market cap..

#### VWO: Vanguard FTSE Emerging Markets Index Fund ETF
#### tracks the return of the FTSE Emerging Markets All Cap China A Inclusion Index.
#### this eft represents stocks of companies located in emerging markets around the world, such as China, Brazil, Taiwan, and South Africa.

#### EWC: iShares MSCI Canada ETF
#### tracks the investment results of an index composed of Canadian equities.
#### this eft represents large and mid-sized companies in Canada.

#### EFA: iShares MSCI EAFE ETF
#### track the investment results of an index composed of large- and mid-capitalization developed market equities, excluding the U.S. and Canada.
#### this etf represents a broad range of companies in Europe, Australia, Asia, and the Far East.

#### VGK: Vanguard FTSE Europe Index Fund ETF Shares
#### tracks the performance of the FTSE Developed Europe All Cap Index, which measures the investment return of stocks issued by companies located in the major markets of Europe.
#### this etf represents stocks of companies located in Austria, Belgium, Denmark, Finland, France, Germany, Greece, Ireland, Italy,  the Netherlands, Norway, Portugal, Spain, Sweden, Switzerland, and the United Kingdom.

#### IOO: iShares Global 100 ETF 
#### tracks the investment results of an index composed of 100 large-capitalization global equities.
#### this etf represents a broad range of large international companies in developed and emerging markets.

#### LQD: iShares iBoxx $ Investment Grade Corporate Bond ETF (did not include)
#### tracks the investment results of an index composed of U.S. dollar-denominated, investment grade corporate bonds. 

#### 2. Governmet Bond
#### SHY: iShares 1-3 Year Treasury Bond ETF
#### tracks the investment results of an index composed of U.S. Treasury bonds with remaining maturities between one and three years.
#### this eft represents short-term U.S. Treasury bonds.

#### IEF: iShares 7-10 Year Treasury Bond ETF
#### tracks the investment results of an index composed of U.S. Treasury bonds with remaining maturities between seven and ten years.
#### this eft represents intermediate-term U.S. Treasury bonds.

#### 3. Inflation Bond
#### TIP: iShares TIPS Bond ETF
#### tracks the investment results of an index composed of inflation-protected U.S. Treasury bonds.
#### this eft represents government bonds whose face value rises with inflation.

#### 4. Real Estate / Commodity
#### IYR: iShares U.S. Real Estate ETF
#### tracks the investment results of an index composed of U.S. equities in the real estate sector.
#### this eft represents U.S. real estate companies and REITs, which invest in real estate directly and trade like stocks.

#### DBC: Invesco DB Commodity Index Tracking Fund (did not include)
#### tracks changes, whether positive or negative, in the level of the DBIQ Optimum Yield Diversified Commodity Index Excess Return™ (DBIQ Opt Yield Diversified Comm Index ER or Index) plus the interest income from the Fund's holdings of primarily US Treasury securities and money market income less the Fund's expenses.
#### this etf represents 14 of the most heavily traded and important physical commodities in the world.

### CAD 
### ref: https://en.wikipedia.org/wiki/List_of_Canadian_exchange-traded_funds#ETF_Table

#### 1. Equity & Credit

#### XSP.TO: iShares Core SP 500 Index
#### tracks the investment results of an index composed of large-capitalization U.S. equities.
#### this etf represents large, established U.S. companies.

#### XIU.TO：iShares S&P/TSX 60 Index ETF
#### tracks the performance of the S&P/TSX 60 Index, net of expenses.
#### this etf represents large, established Canadian companies.

#### XIN.TO: iShares MSCI EAFE Index 
#### track the investment results of an index composed of large- and mid-capitalization developed market equities, excluding the U.S. and Canada.
#### this etf represents a broad range of companies in Europe, Australia, Asia, and the Far East.

#### XBB.TO: iShares Core Canadian Universe Bond Index ETF
#### tracks the performance of the FTSE Canada Universe Bond Index, net of expenses.
#### this eft represents the Canadian investment grade bond market.

#### 2. Governmet Bond

#### XGB.TO: iShares Canadian Government Bond Index ETF
#### tracks the performance of the FTSE Canada All Government Bond Inde, net of expenses.
#### this eft represents Canadian investment grade government bonds with maturities of at least 1 year.

#### 3. Inflation Bond

#### XRB.TO: iShares Canadian Real Return Bond Index ETF
#### tracks the performance of the FTSE Canada Real Return Bond Index™, net of expenses.
#### this eft represents Canadian federal and provincial real return bonds.

#### 4. Real Estate / Commodity

#### XRE.TO: iShares S&P/TSX Capped REIT Index ETF
#### tracks the performance of the S&P/TSX Capped REIT Index, net of expenses..
#### this eft represents different types of Canadian Real Estate Income Trusts (REITs) in a single fund, such as the retail, residential, office and industrial.


## MarcoEconomic data:
## From statistic canada, FED, OECD database

### U.S.

#### U.S. Fed fund rate
#### U.S. CPI: measure of inflation
#### U.S. GDP
#### U.S. Unemployment rate

### Canada

#### CANADA Interest rate
#### CANADA CPI
#### CANADA GDP

#### FX CAD/USD

## Factor data:

### Fama-French factors

#### Rm-Rf: the difference between the return on the value-weight (VW) market portfolio and risk-free rate.
#### SMB: the return on a diversified portfolio of small stocks minus the return on a diversified portfolio of big stocks.
#### HML: the difference between the returns on diversified portfolios of high and low B/M stocks.
#### RMW: the difference between the returns on diversified portfolios of stocks with robust and weak profitability
#### CMA: the difference between the returns on diversified portfolios of low and high investment stocks (conservative and aggressive).

# Folder: performance_data ===================================================
# Time 2011-2016
# Test result generated using different strategies

## EW: Equal Weighted
## AW: All Weather
## MV: Minimum Variance
## MS: Maxium Sharpe Ratio: based on previous Sharpe ratio maximiztion weighting scheme during the calibraation period, assume market sability, invest accordingly in the next period.
## NR: Naive Risk Parity
## RP: Risk Parity
## TF: Trend Following: using EW as base, tile more weight in rising etfs 
## TR: Trend Reversal: using EW as base, tile less weight in rising etfs

## each strategy inculdes two accounts, usd and cad. Also inculdes price time series data and return data.
## e.g: usd_AW_v.xlsx: the USD account position using All Weather. 
##      usd_AW_v_return.xlsx: return calculation based on usd_AW_v.xlsx


# Folder: report_data ===================================================
# Time 2016-2021
# result from the selected strategy

## AW is selected. 
## include price and return information of portfolio. some other info such as weight, transaction record, fees, unit of shares holding histry also included.
## e.g: df_R_comb_asset.xlsx: return of combined portfolio
##      df_U_usd_AW_t.xlsx: number of uints in USD account
##      df_W_usd_AW_t.xlsx: weight in USD account
##      df_trans_fee_usd_AW_t.xlsx: transaction fee in USD account
##      df_trans_rec_usd_AW_t.xlsx: transaction record in USD account
##      t1_weights.xlsx: final weight fo run 1


# Folder: code ===================================
# Contains all the code

## Optimize:
## Strategy builder. This is the process of taking processed data and use investment strategy to optimize the portfolio and achieve weight of each asset.
## (has been intergrated with Main)

## Main:
## is the main file for gathering market data, training, validation and testing. Process include data collection from yahoofinance, calibration, asset allocation, rebalancing, fee calculation, performance time series etc, and some preliminary risk metric calculation also added. It takes input_data and produce performance_data and report_data.

## RiskLab_Scenarios:
## Including historical scenarios and hypothetical scenarios.

### Historical scenarios: We select four different historical time series which contain growth scenarios and downturn scenarios, and then learn from the history.
### Hypothetical scenarios: We created three hypothetical scenarios - Base, Upside, and Downside. 
#### Base: Use the MarcoEconomic data on 2021-01-01 as input data to forecast the Macro data in the next few quarters, then utilize regression between historical Macro and factor data to get the forecasted Fator data. Finally, run regression between historical factor and asset data to get the forecasted asset returns and portfolio value.
#### Upside Case: Increase US GDP rate, Inflation keeps at 2%, increase market premium and then forecast.
#### Downside Case: Decrease US GDP rate, increase US Unemployment rate, decrease USDCAD FX, and decrease market premium and then forecast.

## Scenario_Data:
##






        
# Folder: Analysis ====================================
# contains all the analysis of report data

## analysis_ecodata.xlsx: the relationship between macroeconomic factors and Fama French factors.
## analysis_sharpe11-16.xlsx: the portoflio perfromance of 7 different strategies including AW, EW, MV, NR, RP, MS, TF from 2011-04-01 to 2016-04-01.
## analysis_sharpe16-21.xlsx: the portoflio perfromance of AW strategies from 2016-04-01 to 2021-06-01. run1 is before the reduction of IYR, run2 is after.
## analysis_year.xlsx: the annually return of different asset classes.
## AW_position_weights.xlsx: the exposure history and weight by asset, asset class, currency for AW run1 and run2.
## VaR_analysis_run2.xlsx: detail calculation and analysis of various VaR metrics by asset, asset class, combined currency, for both AW runs. Dashboard and charts included.
## Yearly returns by class.xlsx: yearly return by asset class comparied with portfolio and benchmark.
## assets_benchmark_returns.xlsx: assets, portfolio and benchmark returns since 2016-4-1.

# Folder: template_reference ==========================
# for our own reference


#






